Youâ€™re seeing this because youâ€™re trying to **use Stripeâ€™s secret key (`sk_live_...`) in your frontend code**, which is **dangerous and incorrect**.

---

## âŒ Whatâ€™s Wrong

The screenshot shows instructions that say:
> â€œ**Never put secret key in HTML/JS**â€ â€” âœ… Youâ€™re doing it right by using `pk_live_...` (public key)  
> But then it says:  
> â€œ**You must set `STRIPE_SECRET_KEY` in your Vercel environment variables**â€

That means:  
âž¡ï¸ **Your backend (Vercel Serverless Function) needs the secret key.**  
âž¡ï¸ **Your frontend (React) should only use the public key.**

---

## âœ… How to Fix It

### Step 1: Create a Vercel Serverless Function

Create this file in your project:

#### `pages/api/create-checkout-session.js`

```js
// pages/api/create-checkout-session.js
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { priceId, successUrl, cancelUrl } = req.body;

  try {
    const session = await stripe.checkout.sessions.create({
      mode: 'payment',
      line_items: [{ price: priceId, quantity: 1 }],
      success_url: successUrl,
      cancel_url: cancelUrl,
      billing_address_collection: 'required',
    });

    res.status(200).json({ sessionId: session.id });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
}
```

---

### Step 2: Set Environment Variable in Vercel

Go to [Vercel Dashboard â†’ Your Project â†’ Settings â†’ Environment Variables](https://vercel.com/docs/projects/environment-variables)

Add:

| Name               | Value                 |
|--------------------|-----------------------|
| `STRIPE_SECRET_KEY` | `sk_live_...` (your secret key) |

> ðŸ” Never commit this to GitHub or expose it in frontend code.

---

### Step 3: Update Your Product Data

In your `products` array, add `priceId` for each product:

```js
const products = [
  {
    id: "personalized_bouquets",
    name: "Personalized Bouquets",
    price: 50,
    priceId: "price_1NxYzABC123...", // â† Get this from Stripe Dashboard
    description: "...",
    category: "Bouquets",
    imagePlaceholder: "personalized_bouquets"
  },
  // ... others
];
```

---

### Step 4: Update ProductCard to Use Stripe Checkout

Replace your current â€œOrder Nowâ€ button with this:

```jsx
function ProductCard({ product, allImages }) {
  const handleCheckout = async () => {
    if (!product.priceId) {
      // Fallback to WhatsApp
      window.open(
        `https://wa.me/16093791145?text=${encodeURIComponent(
          `Hi! Iâ€™d like to order: ${product.name} ($${product.price})`
        )}`,
        '_blank'
      );
      return;
    }

    // Call your backend to create a Checkout Session
    const response = await fetch('/api/create-checkout-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        priceId: product.priceId,
        successUrl: `${window.location.origin}/success`,
        cancelUrl: `${window.location.origin}#services`,
      }),
    });

    const { sessionId } = await response.json();

    // Redirect to Stripe Checkout
    const stripe = Stripe('pk_live_51SFMunRW4qIwWPIwoVHw2MRDqfzhdPfRSWfu5bCpgrupt98pJTBiFYchY2jiyksA4JHMiDHp1kS4x1MseC0Ia41v@0BkSkibF1');
    await stripe.redirectToCheckout({ sessionId });
  };

  return (
    <div className="...">
      {/* ... */}
      <button
        onClick={handleCheckout}
        className="block w-full bg-mp-purple text-white py-3 rounded-lg font-medium hover:bg-mp-lilac"
      >
        {product.priceId ? 'Pay Securely' : 'Order on WhatsApp'}
      </button>
    </div>
  );
}
```

---

### Step 5: Add Stripe.js via CDN

Before your React script, add:

```html
<script src="https://js.stripe.com/v3/"></script>
```

And replace any `import { loadStripe }` with:

```js
const stripe = Stripe('pk_live_51SFMunRW4qIwWPIwoVHw2MRDqfzhdPfRSWfu5bCpgrupt98pJTBiFYchY2jiyksA4JHMiDHp1kS4x1MseC0Ia41v@0BkSkibF1');
```

---

## ðŸš« Common Mistakes to Avoid

| Mistake | Why Itâ€™s Bad | Fix |
|--------|--------------|-----|
| Using `sk_live_...` in frontend | Exposes your account to fraud | Only use it in backend (Vercel env vars) |
| Hardcoding prices in frontend | User can change price | Prices must come from Stripe Price IDs |
| Not validating webhook events | Canâ€™t fulfill orders securely | Later, add webhook to mark orders as paid |

---

## âœ… Summary

1. âœ… Keep `pk_live_...` in frontend â€” itâ€™s safe.
2. ðŸš« Never put `sk_live_...` in frontend.
3. âž• Add Vercel serverless function `/api/create-checkout-session`.
4. âž• Set `STRIPE_SECRET_KEY` in Vercel environment variables.
5. âž• Add `priceId` to your products in Stripe Dashboard.
6. ðŸ”„ Replace WhatsApp button with Stripe Checkout button.

Once done, customers can **pay securely** without leaving your brand experience.

Would you like me to generate the **full updated HTML file** with these changes?
